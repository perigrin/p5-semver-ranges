#!/usr/bin/env perl
use strict;
use Test::More;

use SemVer::Ranges qw(gt lt eq neq cmp lte gte satisfies);

{
next;
    # comparison tests
    my @versions = (
        [ '0.0.0',  '0.0.0-foo' ],
        [ '0.0.1',  '0.0.0' ],
        [ '1.0.0',  '0.9.9' ],
        [ '0.10.0', '0.9.0' ],
        [ '0.99.0', '0.10.0', {} ],
        [ '2.0.0',   '1.2.3',      { loose => 0 } ],
        [ 'v0.0.0',  '0.0.0-foo',  1 ],
        [ 'v0.0.1',  '0.0.0',      { loose => 1 } ],
        [ 'v1.0.0',  '0.9.9',      1 ],
        [ 'v0.10.0', '0.9.0',      1 ],
        [ 'v0.99.0', '0.10.0',     1 ],
        [ 'v2.0.0',  '1.2.3',      1 ],
        [ '0.0.0',   'v0.0.0-foo', 1 ],
        [ '0.0.1',   'v0.0.0',     1 ],
        [ '1.0.0',   'v0.9.9',     1 ],
        [ '0.10.0',  'v0.9.0',     1 ],
        [ '0.99.0',  'v0.10.0',    1 ],
        [ '2.0.0',   'v1.2.3',     1 ],
        [ '1.2.3',   '1.2.3-asdf' ],
        [ '1.2.3',   '1.2.3-4' ],
        [ '1.2.3',   '1.2.3-4-foo' ],

        [ '1.2.3-5-foo',        '1.2.3-5' ],
        [ '1.2.3-5',            '1.2.3-4' ],
        [ '1.2.3-5-foo',        '1.2.3-5-Foo' ],
        [ '3.0.0',              '2.7.2+asdf' ],
        [ '1.2.3-a.10',         '1.2.3-a.5' ],
        [ '1.2.3-a.b',          '1.2.3-a.5' ],
        [ '1.2.3-a.b',          '1.2.3-a' ],
        [ '1.2.3-a.b.c.10.d.5', '1.2.3-a.b.c.5.d.100' ],
        [ '1.2.3-r2',           '1.2.3-r100' ],
        [ '1.2.3-r100',         '1.2.3-R2' ]

    );

    for my $pair (@versions) {
        ok gt( @$pair[ 0, 1 ] ), "gt @$pair";
        ok lt( @$pair[ 1, 0 ] ), "lt @$pair";
        ok !gt( @$pair[ 1, 0 ] ), "!gt @$pair";
        ok !lt( @$pair[ 0, 1 ] ), "!gt @$pair";
        ok eq ( @$pair[ 0, 0 ] ), "eq $pair->[0]";
        ok eq ( @$pair[ 1, 1 ] ), "eq $pair->[1]";
        ok neq( @$pair[ 0, 1 ] ), "neq @$pair";
        ok cmp( $pair->[1], '==', $pair->[1] ),
          "cmp $pair->[1], '==', $pair->[1]";
        ok cmp( $pair->[0], '>=', $pair->[1] ),
          "cmp $pair->[0], '>=', $pair->[1]";
        ok cmp( $pair->[1], '<=', $pair->[0] ),
          "cmp $pair->[1], '<=', $pair->[0]";
        ok cmp( $pair->[0], '!=', $pair->[1] ),
          "cmp $pair->[0], '!=', $pair->[1]";
    }
}

{
next;
    my @versions = (
        [ '1.2.3',            'v1.2.3',                   0 ],
        [ '1.2.3+build',      '1.2.3+otherbuild' ],
        [ 'v1.2.3+build',     '1.2.3+otherbuild' ],
        [ '1.2.3-beta+build', '1.2.3-beta+otherbuild' ],
    );

=for later
        [ '1.2.3',            '=1.2.3',                   1 ],
        [ '1.2.3',            'v 1.2.3',                  1 ],
        [ '1.2.3',            '= 1.2.3',                  1 ],
        [ '1.2.3',            ' v1.2.3',                  1 ],
        [ '1.2.3',            ' =1.2.3',                  1 ],
        [ '1.2.3',            ' v 1.2.3',                 1 ],
        [ '1.2.3',            ' = 1.2.3',                 1 ],
        [ '1.2.3-0',          'v1.2.3-0',                 1 ],
        [ '1.2.3-0',          '=1.2.3-0',                 1 ],
        [ '1.2.3-0',          'v 1.2.3-0',                1 ],
        [ '1.2.3-0',          '= 1.2.3-0',                1 ],
        [ '1.2.3-0',          ' v1.2.3-0',                1 ],
        [ '1.2.3-0',          ' =1.2.3-0',                1 ],
        [ '1.2.3-0',          ' v 1.2.3-0',               1 ],
        [ '1.2.3-0',          ' = 1.2.3-0',               1 ],
        [ '1.2.3-1',          'v1.2.3-1',                 1 ],
        [ '1.2.3-1',          '=1.2.3-1',                 1 ],
        [ '1.2.3-1',          'v 1.2.3-1',                1 ],
        [ '1.2.3-1',          '= 1.2.3-1',                1 ],
        [ '1.2.3-1',          ' v1.2.3-1',                1 ],
        [ '1.2.3-1',          ' =1.2.3-1',                1 ],
        [ '1.2.3-1',          ' v 1.2.3-1',               1 ],
        [ '1.2.3-1',          ' = 1.2.3-1',               1 ],
        [ '1.2.3-beta',       'v1.2.3-beta',              1 ],
        [ '1.2.3-beta',       '=1.2.3-beta',              1 ],
        [ '1.2.3-beta',       'v 1.2.3-beta',             1 ],
        [ '1.2.3-beta',       '= 1.2.3-beta',             1 ],
        [ '1.2.3-beta',       ' v1.2.3-beta',             1 ],
        [ '1.2.3-beta',       ' =1.2.3-beta',             1 ],
        [ '1.2.3-beta',       ' v 1.2.3-beta',            1 ],
        [ '1.2.3-beta',       ' = 1.2.3-beta',            1 ],
        [ '1.2.3-beta+build', ' = 1.2.3-beta+otherbuild', 1 ],
        [ '1.2.3+build',      ' = 1.2.3+otherbuild',      1 ],
=cut

    for my $pair (@versions) {
        ok eq (@$pair), "eq @$pair";
        ok !neq(@$pair), "!neq @$pair";
        ok cmp( $pair->[0], '==', $pair->[1] ),
          "cmp($pair->[0], '==', $pair->[1])";
         ok !cmp( $pair->[0], '!=', $pair->[1] ),
          "cmp($pair->[0], '!=', $pair->[1])";
        # skipped === and !==
        ok !gt(@$pair[0,1]), "!gt(@$pair[0,1])";
        ok gte(@$pair[0,1]), "gte(@$pair[0,1])";
        ok !lt(@$pair[0,1]), "!lt(@$pair[0,1])";
        ok lte(@$pair[0,1]), "lte(@$pair[0,1])";
    }
}

{
    my @versions = (
        [ '1.0.0 - 2.0.0',                   '1.2.3' ],
    );
=for later
        [ '^1.2.3+build',                    '1.2.3' ],
        [ '^1.2.3+build',                    '1.3.0' ],
        [ '1.2.3-pre+asdf - 2.4.3-pre+asdf', '1.2.3' ],
        [ '1.2.3pre+asdf - 2.4.3-pre+asdf',  '1.2.3', 1 ],
        [ '1.2.3-pre+asdf - 2.4.3pre+asdf',  '1.2.3', 1 ],
        [ '1.2.3pre+asdf - 2.4.3pre+asdf',   '1.2.3', 1 ],
        [ '1.2.3-pre+asdf - 2.4.3-pre+asdf', '1.2.3-pre.2' ],
        [ '1.2.3-pre+asdf - 2.4.3-pre+asdf', '2.4.3-alpha' ],
        [ '1.2.3+asdf - 2.4.3+asdf',         '1.2.3' ],

        [ '1.0.0', '1.0.0' ],
        [ '>=*',   '0.2.4' ],
        [ '',      '1.0.0' ],
        [ '*', '1.2.3', {} ],

        [ '*',          'v1.2.3', { loose => 123 } ],
        [ '>=1.0.0',    '1.0.0',  /asdf/ ],
        [ '>=1.0.0',    '1.0.1',  { loose => undef } ],
        [ '>=1.0.0',    '1.1.0',  { loose => 0 } ],
        [ '>1.0.0',     '1.0.1',  { loose => undef } ],
        [ '>1.0.0',     '1.1.0' ],
        [ '<=2.0.0',    '2.0.0' ],
        [ '<=2.0.0',    '1.9999.9999' ],
        [ '<=2.0.0',    '0.2.9' ],
        [ '<2.0.0',     '1.9999.9999' ],
        [ '<2.0.0',     '0.2.9' ],
        [ '>= 1.0.0',   '1.0.0' ],
        [ '>=  1.0.0',  '1.0.1' ],
        [ '>=   1.0.0', '1.1.0' ],
        [ '> 1.0.0',    '1.0.1' ],
        [ '>  1.0.0',   '1.1.0' ],
        [ '<=   2.0.0', '2.0.0' ],
        [ '<= 2.0.0',   '1.9999.9999' ],
        [ '<=  2.0.0',  '0.2.9' ],
        [ '<    2.0.0', '1.9999.9999' ],
        [ '<\t2.0.0',   '0.2.9' ],
        [ '>=0.1.97',          'v0.1.97', 1 ],
        [ '>=0.1.97',          '0.1.97' ],
        [ '0.1.20 || 1.2.4',   '1.2.4' ],
        [ '>=0.2.3 || <0.0.1', '0.0.0' ],
        [ '>=0.2.3 || <0.0.1', '0.2.3' ],
        [ '>=0.2.3 || <0.0.1', '0.2.4' ],
        [ '||',                '1.3.4' ],
        [ '2.x.x',             '2.1.3' ],
        [ '1.2.x',             '1.2.3' ],
        [ '1.2.x || 2.x',      '2.1.3' ],
        [ '1.2.x || 2.x',      '1.2.3' ],
        [ 'x',                 '1.2.3' ],
        [ '2.*.*',             '2.1.3' ],
        [ '1.2.*',             '1.2.3' ],
        [ '1.2.* || 2.*',      '2.1.3' ],
        [ '1.2.* || 2.*',      '1.2.3' ],
        [ '*',                 '1.2.3' ],
        [ '2',                 '2.1.2' ],
        [ '2.3',               '2.3.1' ],
        [ '~x',                '0.0.9' ],

        # >= 2.4.0 < 2.5.0 [ '~2',   '2.0.9' ],
        # >= 2.4.0 < 2.5.0 [ '~2.4', '2.4.0' ],
        # >= 2.4.0 < 2.5.0 [ '~2.4', '2.4.5' ],
        [ '~>3.2.1', '3.2.2' ],

        # >= 3.2.1 < 3.3.0,
        [ '~1', '1.2.3' ],

        # >= 1.0.0 < 2.0.0 [ '~>1', '1.2.3' ],
        [ '~> 1', '1.2.3' ],
        [ '~1.0', '1.0.2' ],

        # >= 1.0.0 < 1.1.0,
        [ '~ 1.0',                '1.0.2' ],
        [ '~ 1.0.3',              '1.0.12' ],
        [ '>=1',                  '1.0.0' ],
        [ '>= 1',                 '1.0.0' ],
        [ '<1.2',                 '1.1.1' ],
        [ '< 1.2',                '1.1.1' ],
        [ '~v0.5.4-pre',          '0.5.5' ],
        [ '~v0.5.4-pre',          '0.5.4' ],
        [ '=0.7.x',               '0.7.2' ],
        [ '<=0.7.x',              '0.7.2' ],
        [ '>=0.7.x',              '0.7.2' ],
        [ '<=0.7.x',              '0.6.2' ],
        [ '~1.2.1 >=1.2.3',       '1.2.3' ],
        [ '~1.2.1 =1.2.3',        '1.2.3' ],
        [ '~1.2.1 1.2.3',         '1.2.3' ],
        [ '~1.2.1 >=1.2.3 1.2.3', '1.2.3' ],
        [ '~1.2.1 1.2.3 >=1.2.3', '1.2.3' ],
        [ '~1.2.1 1.2.3',         '1.2.3' ],
        [ '>=1.2.1 1.2.3',        '1.2.3' ],
        [ '1.2.3 >=1.2.1',        '1.2.3' ],
        [ '>=1.2.3 >=1.2.1',      '1.2.3' ],
        [ '>=1.2.1 >=1.2.3',      '1.2.3' ],
        [ '>=1.2',                '1.2.8' ],
        [ '^1.2.3',               '1.8.1' ],
        [ '^0.1.2',               '0.1.2' ],
        [ '^0.1',                 '0.1.2' ],
        [ '^0.0.1',               '0.0.1' ],
        [ '^1.2',                 '1.4.2' ],
        [ '^1.2 ^1',              '1.4.2' ],
        [ '^1.2.3-alpha',         '1.2.3-pre' ],
        [ '^1.2.0-alpha',         '1.2.0-pre' ],
        [ '^0.0.1-alpha',         '0.0.1-beta' ],
        [ '^0.1.1-alpha',         '0.1.1-beta' ],
        [ '^x',                   '1.2.3' ],
        [ 'x - 1.0.0',            '0.9.7' ],
        [ 'x - 1.x',              '0.9.7' ],
        [ '1.0.0 - x',            '1.9.7' ],
        [ '1.x - x',              '1.9.7' ],
        [ '<=7.x',                '7.9.9' ]
    );

=cut

    for my $pair (@versions) {
        ok satisfies(@$pair), "$pair->[0] satsifed by $pair->[1]";
    }
}

done_testing();
__END__
